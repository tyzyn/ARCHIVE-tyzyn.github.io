<!DOCTYPE html>
<html lang="en">
<head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
	<title>Chris Tyson : In the Spot-light</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        <link href="./" type="application/atom+xml" rel="alternate" title="Chris Tyson ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body>

  <nav class="navbar">
    <ul class="navbar-nav">
      <li class="logo">
	<a href="/" class="nav-link">
	<span class="link-text logo-text">Chris Tyson</span>
          <svg
            aria-hidden="true"
            focusable="false"
            data-prefix="fad"
            data-icon="angle-double-right"
            role="img"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 448 512"
            class="svg-inline--fa fa-angle-double-right fa-w-14 fa-5x">
            <g class="fa-group">
              <path
                fill="currentColor"
                d="M224 273L88.37 409a23.78 23.78 0 0 1-33.8 0L32 386.36a23.94 23.94 0 0 1 0-33.89l96.13-96.37L32 159.73a23.94 23.94 0 0 1 0-33.89l22.44-22.79a23.78 23.78 0 0 1 33.8 0L223.88 239a23.94 23.94 0 0 1 .1 34z"
                class="fa-secondary"
              ></path>
              <path
                fill="currentColor"
                d="M415.89 273L280.34 409a23.77 23.77 0 0 1-33.79 0L224 386.26a23.94 23.94 0 0 1 0-33.89L320.11 256l-96-96.47a23.94 23.94 0 0 1 0-33.89l22.52-22.59a23.77 23.77 0 0 1 33.79 0L416 239a24 24 0 0 1-.11 34z"
                class="fa-primary"
              ></path>
            </g>
          </svg>
	</a>
      </li>

      <li class="nav-item">
        <a href="/about.html" class="nav-link">
          <svg aria-hidden="true"
               focusable="false"
               data-prefix="fas"
               data-icon="user-circle"
               class="svg-inline--fa fa-briefcase fa-w-16"
               role="img"
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 512 512">
            <g class="fa-group">
            <path fill="currentColor"
                  class="fa-primary"
                  d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z">
            </path>
            </g>
          </svg>
          <span class="link-text">About</span>
        </a>
      </li>

      <li class="nav-item">
        <a href="/blog.html" class="nav-link">
          <svg aria-hidden="true"
               focusable="false"
               data-prefix="fas"
               data-icon="pen-alt"
               class="svg-inline--fa fa-briefcase fa-w-16"
               role="img"
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 512 512">
            <g class="fa-group">
            <path fill="currentColor"
                  class="fa-primary"
                  d="M497.94 74.17l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.75 18.75-49.15 0-67.91zm-246.8-20.53c-15.62-15.62-40.94-15.62-56.56 0L75.8 172.43c-6.25 6.25-6.25 16.38 0 22.62l22.63 22.63c6.25 6.25 16.38 6.25 22.63 0l101.82-101.82 22.63 22.62L93.95 290.03A327.038 327.038 0 0 0 .17 485.11l-.03.23c-1.7 15.28 11.21 28.2 26.49 26.51a327.02 327.02 0 0 0 195.34-93.8l196.79-196.79-82.77-82.77-84.85-84.85z">
            </path>
            </g>
          </svg>
          <span class="link-text">Blog</span>
        </a>
      </li> 

      <li class="nav-item">
        <a href="/projects.html" class="nav-link">
          <svg aria-hidden="true"
               focusable="false"
               data-prefix="fas"
               data-icon="code"
               class="svg-inline--fa fa-briefcase fa-w-16"
               role="img"
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 640 512">
            <g class="fa-group">
            <path fill="currentColor"
                  class="fa-primary"
                  d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z">
            </path>
            </g>
          </svg>
	  <span class="link-text">Projects</span>
        </a>
      </li>

      <li class="nav-item">
        <a href="/documents/cv.pdf" class="nav-link">
	  <svg aria-hidden="true"
	       focusable="false"
	       data-prefix="fas"
	       data-icon="briefcase"
	       class="svg-inline--fa fa-briefcase fa-w-16"
	       role="img"
	       xmlns="http://www.w3.org/2000/svg"
	       viewBox="0 0 512 512">
	    <g class="fa-group">
	    <path fill="currentColor"
		  class="fa-primary"
	          d="M320 336c0 8.84-7.16 16-16 16h-96c-8.84 0-16-7.16-16-16v-48H0v144c0 25.6 22.4 48 48 48h416c25.6 0 48-22.4 48-48V288H320v48zm144-208h-80V80c0-25.6-22.4-48-48-48H176c-25.6 0-48 22.4-48 48v48H48c-25.6 0-48 22.4-48 48v80h512v-80c0-25.6-22.4-48-48-48zm-144 0H192V96h128v32z">
	    </path>
	    </g>
	  </svg>
          <span class="link-text">CV</span>
        </a>
      </li>

    </ul>
  </nav>

  <div id="wrap" style="width:850px">
    <div id="container" style="width:560px">

      <div class="entry">
        
<header>
<h1><a href="." id="site-title">  </a>         <a href="./in-the-spotlight.html" id="page-title">In the Spot-light</a></h1>
<time datetime="2019-02-05T00:00:00+00:00">Tue 05 February 2019</time></header>
<article>
    <p>A few months ago I bought some "Yeelight" bulbs, a cheaper, versatile, Chinese alternative to many of the popular smart bulbs on the market. However because they're quite obscure, I've found that it can often be quite hard to integrate things with them. My Alexa doesn't even seem to recognise them as devices, but I can still use IFTTT to turn them on, change colours, "scenes" etc.</p>
<p>I wanted to see if I could get them to have more complex behaviour, and one thing I was really interested in trying was to get them to sync to my current playing song on Spotify.</p>
<p>I went about trying to do this, and found some code for developers on the Yeelight website that can do things like toggle lights on and off, change brightness...</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">operate_on_bulb</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Operate on bulb; no gurantee of success.</span>
<span class="sd">  Input data &#39;params&#39; must be a compiled into one string.</span>
<span class="sd">  E.g. params=&quot;1&quot;; params=&quot;\&quot;smooth\&quot;&quot;, params=&quot;1,\&quot;smooth\&quot;,80&quot;</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">bulb_idx2ip</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s2">&quot;error: invalid bulb idx&quot;</span>
    <span class="k">return</span>

  <span class="n">bulb_ip</span><span class="o">=</span><span class="n">bulb_idx2ip</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">bulb_ip</span><span class="p">)</span>
  <span class="n">port</span><span class="o">=</span><span class="n">detected_bulbs</span><span class="p">[</span><span class="n">bulb_ip</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">tcp_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;connect &quot;</span><span class="p">,</span><span class="n">bulb_ip</span><span class="p">,</span> <span class="n">port</span> <span class="p">,</span><span class="s2">&quot;...&quot;</span>
    <span class="n">tcp_socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">bulb_ip</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)))</span>
    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">id</span><span class="se">\&quot;</span><span class="s2">:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">next_cmd_id</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\&quot;</span><span class="s2">method</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">method</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">params</span><span class="se">\&quot;</span><span class="s2">:[&quot;</span> <span class="o">+</span> <span class="n">params</span> <span class="o">+</span> <span class="s2">&quot;]}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
    <span class="n">tcp_socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">tcp_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">e</span>
</code></pre></div>

<p>The code uses this operate_on_bulb function, and needs to be sent with my computer on the same Wifi network that my bulbs are connected to. When you run the code you are able to list the available bulbs that you are connected to, and each bulb receives an index starting at 1. A function is given that uses this operate_on_bulb function that can change the brightness of lights:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_bright</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">bright</span><span class="p">):</span>
  <span class="n">operate_on_bulb</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;set_bright&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bright</span><span class="p">))</span>
</code></pre></div>

<p>So for example I can use set_bright(1, 50) to change the bulb with 1st index to 50% brightness. With some reading of the "Yeelight WiFi Light Inter-Operation Specification" (say that 5 times fast) I figured out that with some minor tweaking you can get the code to change bulb colour. The colour must be passed in decimal format, so this can be translated from the more readable hex code representation rather easily using Python's native int function.</p>
<p>My function for changing colour is below (forgive the American-English):</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_color</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">rgb</span><span class="p">):</span>
  <span class="n">rgb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
  <span class="n">operate_on_bulb</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;set_rgb&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">rgb</span><span class="p">))</span>
</code></pre></div>

<p>So if I wanted to change the colour of the 1st indexed bulb to pure red, i.e. "#ff0000", I can call set_color(1, "ff0000"). The hex code "ff0000" will be translated to the integer int("ff0000", 16) -&gt; 16711680, which will then be sent over as a string.</p>
<h2>The Spotify Problem</h2>
<p>Now that I had this working I wanted to turn my attention to getting the current song on Spotify, because if that wasn't feasible then the whole project would fall down. I looked at the api for a while and found nothing that would be appropriate, especially with rate limiting getting in the way.</p>
<p>However seeing as my code would need to be running on my computer anyway, and the Spotify client updates the current playing song on all devices at the same time, there is an easier way.</p>
<p>I found someone on askubuntu asking about how to get the current playing song on spotify using the command line (given that the Spotify client is currently open on the same computer). The following command was given and this only gets the current song title:</p>
<div class="highlight"><pre><span></span><code><span class="nt">dbus-send</span> <span class="nt">--print-reply</span> <span class="nt">--dest</span><span class="o">=</span><span class="nt">org</span><span class="p">.</span><span class="nc">mpris</span><span class="p">.</span><span class="nc">MediaPlayer2</span><span class="p">.</span><span class="nc">spotify</span> <span class="o">/</span><span class="nt">org</span><span class="o">/</span><span class="nt">mpris</span><span class="o">/</span><span class="nt">MediaPlayer2</span> <span class="nt">org</span><span class="p">.</span><span class="nc">freedesktop</span><span class="p">.</span><span class="nc">DBus</span><span class="p">.</span><span class="nc">Properties</span><span class="p">.</span><span class="nc">Get</span> <span class="nt">string</span><span class="p">:</span><span class="nd">org</span><span class="p">.</span><span class="nc">mpris</span><span class="p">.</span><span class="nc">MediaPlayer2</span><span class="p">.</span><span class="nc">Player</span> <span class="nt">string</span><span class="p">:</span><span class="nd">Metadata</span> <span class="o">|</span> <span class="nt">sed</span> <span class="nt">-n</span> <span class="s1">&#39;/title/{n;p}&#39;</span> <span class="o">|</span> <span class="nt">cut</span> <span class="nt">-d</span> <span class="s1">&#39;&quot;&#39;</span> <span class="nt">-f</span> <span class="nt">2</span>
</code></pre></div>

<p>However with a bit more investigation of what this command is doing, you're able to get a lot more information by taking out some of these commands. If we reduce the command to:</p>
<div class="highlight"><pre><span></span><code><span class="nv">dbus</span><span class="o">-</span><span class="k">send</span> <span class="o">--</span><span class="nv">print</span><span class="o">-</span><span class="nv">reply</span> <span class="o">--</span><span class="nv">dest</span><span class="o">=</span><span class="nv">org</span>.<span class="nv">mpris</span>.<span class="nv">MediaPlayer2</span>.<span class="nv">spotify</span> <span class="o">/</span><span class="nv">org</span><span class="o">/</span><span class="nv">mpris</span><span class="o">/</span><span class="nv">MediaPlayer2</span> <span class="nv">org</span>.<span class="nv">freedesktop</span>.<span class="nv">DBus</span>.<span class="nv">Properties</span>.<span class="nv">Get</span> <span class="nv">string</span>:<span class="nv">org</span>.<span class="nv">mpris</span>.<span class="nv">MediaPlayer2</span>.<span class="nv">Player</span> <span class="nv">string</span>:<span class="nv">Metadata</span>
</code></pre></div>

<p>Then out comes a bunch more information about the current playing song:</p>
<div class="highlight"><pre><span></span><code><span class="n">method</span> <span class="k">return</span> <span class="n">time</span><span class="o">=</span><span class="mf">1549364930.028762</span> <span class="n">sender</span><span class="o">=</span><span class="p">:</span><span class="mf">1.149</span> <span class="o">-&gt;</span> <span class="n">destination</span><span class="o">=</span><span class="p">:</span><span class="mf">1.1121207</span> <span class="n">serial</span><span class="o">=</span><span class="mi">1122063</span> <span class="n">reply_serial</span><span class="o">=</span><span class="mi">2</span>
   <span class="n">variant</span>       <span class="n">array</span> <span class="p">[</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;mpris:trackid&quot;</span>
            <span class="n">variant</span>                <span class="n">string</span> <span class="s2">&quot;spotify:track:60AEGzxRNUQ3Pzg4tygzJC&quot;</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;mpris:length&quot;</span>
            <span class="n">variant</span>                <span class="n">uint64</span> <span class="mi">319000000</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;mpris:artUrl&quot;</span>
            <span class="n">variant</span>                <span class="n">string</span> <span class="s2">&quot;https://open.spotify.com/image/50d898136e5150ce32cb88d7d48824c8d59f3c89&quot;</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:album&quot;</span>
            <span class="n">variant</span>                <span class="n">string</span> <span class="s2">&quot;This Is All Yours&quot;</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:albumArtist&quot;</span>
            <span class="n">variant</span>                <span class="n">array</span> <span class="p">[</span>
                  <span class="n">string</span> <span class="s2">&quot;alt-J&quot;</span>
               <span class="p">]</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:artist&quot;</span>
            <span class="n">variant</span>                <span class="n">array</span> <span class="p">[</span>
                  <span class="n">string</span> <span class="s2">&quot;alt-J&quot;</span>
               <span class="p">]</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:autoRating&quot;</span>
            <span class="n">variant</span>                <span class="n">double</span> <span class="mf">0.45</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:discNumber&quot;</span>
            <span class="n">variant</span>                <span class="n">int32</span> <span class="mi">1</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:title&quot;</span>
            <span class="n">variant</span>                <span class="n">string</span> <span class="s2">&quot;Bloodflood, Pt. II&quot;</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:trackNumber&quot;</span>
            <span class="n">variant</span>                <span class="n">int32</span> <span class="mi">12</span>
         <span class="p">)</span>
         <span class="n">dict</span> <span class="n">entry</span><span class="p">(</span>
            <span class="n">string</span> <span class="s2">&quot;xesam:url&quot;</span>
            <span class="n">variant</span>                <span class="n">string</span> <span class="s2">&quot;https://open.spotify.com/track/60AEGzxRNUQ3Pzg4tygzJC&quot;</span>
         <span class="p">)</span>
      <span class="p">]</span>
</code></pre></div>

<p>And one of the things we can see here is the url for the album art - perfect! This has now solved what was to be the next problem, so we now skip to extracting dominant colours from an image:</p>
<h2>Extracting Colour</h2>
<p>I originally thought extracting dominant, salient colours from an images that are also aethestically pleasing would be a fairly easy task, or that there would at least be a convenient Python library or one-liner that could do this for me. I was wrong.</p>
<p>This is a rather ill-posed problem, with an input that can range wildly. There are also edge cases such as: what do you do when posed with album art that is totally black and white? (which it turns out, there is a lot of...)</p>
<p>In the end, after reading a number of webpages about Colour Theory and tearing my hair out, I decided to settle for a k-means based approach which clusters image colours based on pixel rgb "coordinates".</p>
<div class="highlight"><pre><span></span><code><span class="n">pixels</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pixels</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">width</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">height</span><span class="p">)])</span>

<span class="c1">#make image list of &quot;interesting&quot; (non-grey) pixels</span>
<span class="k">def</span> <span class="nf">interesting_pixel</span><span class="p">(</span><span class="n">pixel</span><span class="p">):</span>
    <span class="c1">#pixel is too grey</span>
    <span class="n">too_grey</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">70</span>
    <span class="c1">#pixel is too white</span>
    <span class="n">too_white</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span>
    <span class="c1">#pixel is too black</span>
    <span class="n">too_black</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pixel</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">70</span>

    <span class="k">return</span> <span class="ow">not</span><span class="p">(</span><span class="n">too_grey</span> <span class="ow">or</span> <span class="n">too_white</span> <span class="ow">or</span> <span class="n">too_black</span><span class="p">)</span>

<span class="n">pixels</span> <span class="o">=</span> <span class="n">pixels</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">pixels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pixels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">pixels</span> <span class="o">=</span> <span class="p">[</span><span class="n">pixel</span> <span class="k">for</span> <span class="n">pixel</span> <span class="ow">in</span> <span class="n">pixels</span> <span class="k">if</span> <span class="n">interesting_pixel</span><span class="p">(</span><span class="n">pixel</span><span class="p">)]</span>
</code></pre></div>

<p>My code first rips all the pixels out the images and throws them into a list, after filtering them to make sure they are "interesting". I'm not interested in grey, black or white pixels (or those that are visually similar) so I defined a metric that plays with this concept.</p>
<p>I then used the KMeans algorithm available in sklearn.cluster to, well... cluster the pixels. The centroids are then used as the "dominant colours" as these are the mean of the cluster. I have two yeelights that are capable of displaying colour, so I thought it would be nice to get the "top two" colours, and then display one on each light.</p>
<p>The results of this work quite well:</p>
<p>~images~</p>
<p>However this obviously works best with images with bold colour schemes, as I've demonstrated above.</p>
<p>I think my method of extracting colours could still do with some tweaking. For example, I could look at colours that work well together in the artwork. In the album art for "Melodrama" by Lorde, my program gets a light and a dark blue. Whereas a dark blue and the warm skin tone colour could be used instead that would possibly be a more visually pleasing / representative combination.</p>
<p>I've also thought about the use of another colour space, as perhaps RGB isn't too appropriate. The standard sklearn KMeans will assume a euclidean distance measure, but something like Manhattan distance could also work better with RGB, as I've been assuming RGB "coordinates".</p>
<p>As well, the method I've used doesn't really do much with album art that is totally black and white. In this case I've currently got it so that the program does nothing when you play a song with black and white album art (a line makes sure that if you strip out all "uninteresting" pixels leaving nothing left, the program breaks before running KMeans on an empty list). Perhaps in the future I might make it change the lights to a random choice from a selection of colours that work well.</p>
<p>However I feel as though what I have so far works well enough, and certainly makes for some interesting mood lighting.</p>
</article>
      </div>
    </div>
  </div>

</body>
</html>